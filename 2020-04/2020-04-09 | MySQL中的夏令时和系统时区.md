- [原文链接](https://www.percona.com/blog/2020/04/09/daylight-saving-time-and-system-time-zone-in-mysql/)

# MySQL中的夏令时和系统时区
- 三月是夏令时制改变的月份。对某些地区，这不仅是时间更改，而且切换到其他时区。例如，纽约冬季使用EST，夏季使用EDT。如果您使用系统时区，并且在切换之后不重启MySQL服务或者PXC节点，您可能会注意到这些更改没有应用。
- 您可能会遇到这样的情况：您的一些集群节点仍然在使用切换之前的时区（例如EST），而其他节点在使用切换之后的时区（例如EDT）。
```
$ date
Sun Mar  8 03:03:28 EDT 2020

$ ./bin/mysql  -h127.0.0.1 -P3373 -uroot test
...
EDT node> show variables like '%zone%';
+------------------+--------+
| Variable_name    | Value  |
+------------------+--------+
| system_time_zone | EDT    |
| time_zone        | SYSTEM |
+------------------+--------+
2 rows in set (0.00 sec)

$ ./bin/mysql  -h127.0.0.1 -P3372 -uroot test
...
EST node> show variables like '%zone%';
+------------------+--------+
| Variable_name    | Value  |
+------------------+--------+
| system_time_zone | EST    |
| time_zone        | SYSTEM |
+------------------+--------+
2 rows in set (0.00 sec)
```
- 我需要为此担心吗？
- **不**！
- MySQL在启动时启用`system_time_zone`参数。即使该参数包含停滞数据，所有计算都将正确执行，并且时差值已经使用新的时区。
- 为了验证这一点，让我们使用一个包含`timestamp`字段的简单表：
```
CREATE TABLE `t1` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `ts` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB
```
- 首先，让我们检查现有数据；无论节点使用`system_time_zone`哪个值，结果都是一样的：
```
EDT node> select * from t1;
+----+---------------------+
| id | ts                  |
+----+---------------------+
|  2 | 2020-03-08 01:03:53 |
|  4 | 2020-03-08 01:03:54 |
|  6 | 2020-03-08 01:03:55 |
+----+---------------------+
3 rows in set (0.00 sec)

EST node> select * from t1;
+----+---------------------+
| id | ts                  |
+----+---------------------+
|  2 | 2020-03-08 01:03:53 |
|  4 | 2020-03-08 01:03:54 |
|  6 | 2020-03-08 01:03:55 |
+----+---------------------+
3 rows in set (0.00 sec)
```
- 如果我们新添加一行，有效的时间戳将插入两个节点：
```
EST node> insert into t1 values();
Query OK, 1 row affected (0.01 sec)

EST node> select * from t1;
+----+---------------------+
| id | ts                  |
+----+---------------------+
|  2 | 2020-03-08 01:03:53 |
|  4 | 2020-03-08 01:03:54 |
|  6 | 2020-03-08 01:03:55 |
|  8 | 2020-03-08 03:02:22 |
+----+---------------------+
4 rows in set (0.00 sec)

EDT node> select * from t1;
+----+---------------------+
| id | ts                  |
+----+---------------------+
|  2 | 2020-03-08 01:03:53 |
|  4 | 2020-03-08 01:03:54 |
|  6 | 2020-03-08 01:03:55 |
|  8 | 2020-03-08 03:02:22 |
+----+---------------------+
4 rows in set (0.00 sec)
```
- 如您所见，在时区更改之前，在节点上新插入的行，在两个节点上均有相同的值。
- 在时区更改后，我们在节点上插入新行，也会发生同样的情况：
```
EDT node> insert into t1 values();
Query OK, 1 row affected (0.01 sec)

EDT node> select * from t1;
+----+---------------------+
| id | ts                  |
+----+---------------------+
|  2 | 2020-03-08 01:03:53 |
|  4 | 2020-03-08 01:03:54 |
|  6 | 2020-03-08 01:03:55 |
|  8 | 2020-03-08 03:02:22 |
|  9 | 2020-03-08 03:02:32 |
+----+---------------------+
5 rows in set (0.00 sec)

EST node> select * from t1;
+----+---------------------+
| id | ts                  |
+----+---------------------+
|  2 | 2020-03-08 01:03:53 |
|  4 | 2020-03-08 01:03:54 |
|  6 | 2020-03-08 01:03:55 |
|  8 | 2020-03-08 03:02:22 |
|  9 | 2020-03-08 03:02:32 |
+----+---------------------+
5 rows in set (0.00 sec)
```
## 总结
- 如果您使用`time_zone=SYSTEM`，您可能会注意到`system_time_zone`参数的值在夏令时更改后已过时。但是您不用为此担心，因为所有的计算都将使用更新后的时间。
